<!DOCTYPE html>
<html lang="en-US">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="author" content="Gershom Tripp">
<meta name="description" content="Introduction Data Import and Preparation Tidying the Data  Visualizing Climate Change in Berlin Proportion of &#43;25°C Days Sunshine Precipitation Days Without Precipitation Air Pressure  Conclusion   Introduction What follows is an EDA inspired by conversations I’ve had about Berlin’s changing climate, something I’ve personally witnessed in the 11&#43; years that I’ve lived here. Part of my motivation also stems from a running disagreement obout the direction of that change: My wife, for example.">

<meta property="og:title" content="How About That Weather!? - An EDA of Climate Change in Berlin." />
<meta property="og:description" content="Introduction Data Import and Preparation Tidying the Data  Visualizing Climate Change in Berlin Proportion of &#43;25°C Days Sunshine Precipitation Days Without Precipitation Air Pressure  Conclusion   Introduction What follows is an EDA inspired by conversations I’ve had about Berlin’s changing climate, something I’ve personally witnessed in the 11&#43; years that I’ve lived here. Part of my motivation also stems from a running disagreement obout the direction of that change: My wife, for example." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/how-about-that-weather-an-eda-of-climate-change-in-berlin/" /><meta property="article:published_time" content="2018-09-17T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2018-09-17T00:00:00&#43;00:00"/>

<title>


     How About That Weather!? - An EDA of Climate Change in Berlin. 

</title>
<link rel="canonical" href="/blog/how-about-that-weather-an-eda-of-climate-change-in-berlin/">







<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/default.min.css">




<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500">



    
    <link rel="stylesheet" href="/css/reset.css?t=2018-09-21%2018%3a27%3a49.598312%20%2b0200%20CEST%20m%3d%2b0.129407245">
    <link rel="stylesheet" href="/css/pygments.css?t=2018-09-21%2018%3a27%3a49.598312%20%2b0200%20CEST%20m%3d%2b0.129407245">
    <link rel="stylesheet" href="/css/main.css?t=2018-09-21%2018%3a27%3a49.598312%20%2b0200%20CEST%20m%3d%2b0.129407245">
    
        <link rel="stylesheet" href="/css/override.css?t=2018-09-21%2018%3a27%3a49.598312%20%2b0200%20CEST%20m%3d%2b0.129407245">
    




<link rel="shortcut icon"

    href="/img/leaf.ico"

>








</head>


<body lang="en">

<section class="header">
    <div class="container">
        <div class="content">
            
                
                
                
                
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                
                <a href="/"><img class="avatar" src="/img/profile-4x.png" srcset="/img/profile-4x.png 1x"></a>
            
            <a href="/"><div class="name">Gershom Tripp</div></a>
            
              <h3 class="self-intro">Freelance Data Scientist, R &amp; Python</h3>
            
            <nav>
                <ul>
                    
                        <li class="nav-blog"><a href="/blog/"><span>Blog</span></a></li>
                    
                        <li class="nav-about"><a href="/about/"><span>About</span></a></li>
                    
                </ul>
            </nav>
        </div>
    </div>
</section>

<section class="icons">
    <div class="container">
        <div class="content">
        
            <a href="//github.com/GershTri" target="_blank" rel="noopener"><img class="icon" src="/img/github.svg" alt="github" /></a>
        

        

        
            <a href="//twitter.com/ppirtmohsreg" target="_blank" rel="noopener"><img class="icon" src="/img/twitter.svg" alt="twitter" /></a>
        

	

        

        

        
            <a href="//linkedin.com/in/gershomtripp" target="_blank" rel="noopener"><img class="icon" src="/img/linkedin.svg" alt="linkedin" /></a>
        

        

        

        

        

        
            <a href="mailto:gershtripp@gmail.com"><img class="icon" src="/img/email.svg" alt="email" /></a>
        

        

        
        </div>
    </div>
</section>


<section class="main post non-narrow zero-top-spacing">
    <div class="container">
        <div class="content">
            <div class="front-matter">
                <div class="title-container">
                    <div class="page-heading">

    How About That Weather!? - An EDA of Climate Change in Berlin.

</div>

                    <div class="initials"><a href="/">ad</a></div>
                </div>
                <div class="meta">
                    
                    <div class="date" title='Mon Sep 17 2018 00:00:00 UTC'>Sep 17, 2018</div>
                    
                    
		    <div class="reading-time"><div class="middot"></div>18 minutes read</div>
                    
                </div>
            </div>
            <div class="markdown">
                <div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#data-import-and-preparation">Data Import and Preparation</a><ul>
<li><a href="#tidying-the-data">Tidying the Data</a></li>
</ul></li>
<li><a href="#visualizing-climate-change-in-berlin">Visualizing Climate Change in Berlin</a><ul>
<li><a href="#proportion-of-25c-days">Proportion of +25°C Days</a></li>
<li><a href="#sunshine">Sunshine</a></li>
<li><a href="#precipitation">Precipitation</a></li>
<li><a href="#days-without-precipitation">Days Without Precipitation</a></li>
<li><a href="#air-pressure">Air Pressure</a></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</div>

<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>What follows is an <a href="https://en.wikipedia.org/wiki/Exploratory_data_analysis">EDA</a> inspired by conversations I’ve had about Berlin’s changing climate, something I’ve personally witnessed in the 11+ years that I’ve lived here. Part of my motivation also stems from a running disagreement obout the direction of that change: My wife, for example. thinks June is a sorry excuse for a summer month, and that it used to be nicer, and I think she might be imagining things. In the end we might both have to modify our positions a bit.</p>
<p>Beyond mere curosity and <a href="https://www.dict.cc/deutsch-englisch/Besserwisser.html">Besserwisserei</a>, I think it’s important to explore how global warming and climate change manifest themselves at the local level. Climate change is happening <a href="https://climate.nasa.gov/effects/">now</a>, and there’s some evidence that it’s accelerating even <a href="https://www.theguardian.com/world/2018/aug/21/arctics-strongest-sea-ice-breaks-up-for-first-time-on-record">faster than predicted</a>.</p>
<p>For the record, I’m neither a climatoligist nor a meteorologist, and nothing about my analysis is going to be cutting edge or original. I’ll avoid making too many inferences based on the data, focussing instead on exploration. That having been said, I should still be able draw some conclusions, however tentative.</p>
<p>The next couple of sections cover how I wrangle the data into a more manageable form. If you’re not interested in that kind of thing just <a href="#visualizing-climate-change-in-berlin">skip to the analysis</a>.</p>
<hr />
</div>
<div id="data-import-and-preparation" class="section level2">
<h2>Data Import and Preparation</h2>
<p>First off, the libraries:</p>
<pre class="r"><code>library(readr)
library(dplyr)
library(tidyr)
library(stats)
library(psych)
library(lubridate)
library(ggplot2)
library(corrplot)</code></pre>
<p>The data is a subset of the <a href="https://www.dwd.de/DE/leistungen/klimadatendeutschland/klarchivtagmonat.html">Deutscher Wetterdienst</a>’s extensive repository of weather data. It’s possible to get hourly measurements, going back decades, but I decided daily averages were enough for this analysis. Downloading the data programmatically from the DWD archive interface would have been horribly complex, so I did it the old-fashioned way: I downloaded the data as four ZIPs (from four Berlin weather stations), extracted the TXT/CSV files, renamed them to something more descriptive, and wrote some code to remove some excess white space that was interfering with the data import.</p>
<p><em>Edit</em>: While putting the final touches on this post I discovered that the DWD offers FTP access to their databases via the <a href="ftp://ftp-cdc.dwd.de/pub/CDC/">Climate Data Center</a>.</p>
<p>The data files are semicolon-delimited. To keep things simple I’ll import everything as character strings. Numeric and date objects are converted later, as needed. The value <code>-999</code> is imported as <code>NA</code>.</p>
<pre class="r"><code># get the names of  the data files, import them as text, remove white space and
# overwrite originals with de-whitespaced files
data_path &lt;- file.path(&quot;datasets&quot;, &quot;berlin_climate_data&quot;)
file_names &lt;- dir(data_path)
file_names &lt;- file_names[grep(pattern = &quot;data&quot;, file_names)]

for (file_name in file_names){
    file_path &lt;- file.path(data_path, file_name)
    file &lt;- read_file(file_path)
    file &lt;- gsub(&quot; &quot;, &quot;&quot;, file)
    write_file(file, file_path)
}

# wrapper function to load data with defaults
read_data &lt;- function(path){
    read_delim(file = path,
               delim = &quot;;&quot;,
               col_types = paste0(rep(&quot;c&quot;, 19), collapse = &quot;&quot;),
               na = &quot;-999&quot;
               )
}

# read in the data
dahlem_fu_data &lt;- read_data(file.path(data_path, &quot;Dahlem-(FU)-data.txt&quot;))
dahlem_lfag_data &lt;- read_data(file.path(data_path, &quot;Dahlem-(LFAG)-data.txt&quot;))
tegel_data &lt;- read_data(file.path(data_path, &quot;Tegel-data.txt&quot;))
tempelhof_data &lt;- read_data(file.path(data_path, &quot;Tempelhof-data.txt&quot;))</code></pre>
<p>It makes sense to take a look at the included parameter files to get an idea what kind of data I’m working with. These are in German (umlauts!), so I’ll use <code>guess_encoding()</code> from the <code>readr</code> library to figure out which ISO I need.</p>
<pre class="r"><code>guess_encoding(&quot;datasets/berlin_climate_data/Dahlem-(FU)-params.txt&quot;) %&gt;% 
    knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">encoding</th>
<th align="right">confidence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ISO-8859-1</td>
<td align="right">0.64</td>
</tr>
<tr class="even">
<td align="left">ISO-8859-9</td>
<td align="right">0.27</td>
</tr>
<tr class="odd">
<td align="left">ISO-8859-2</td>
<td align="right">0.24</td>
</tr>
</tbody>
</table>
<p>ISO-8859-1 it is. I don’t care too much about the details of each station, so I’ll just import one file, <code>Tempelhof-params.txt</code>, to gain some insight into the parameters, i.e. abbreviations, units used, etc.</p>
<pre class="r"><code># load parameter file
data_path &lt;- file.path(&quot;datasets&quot;, &quot;berlin_climate_data&quot;, &quot;Tempelhof-params.txt&quot;)
tempelhof_params &lt;- read_delim(file = data_path,
                               delim = &quot;;&quot;,
                               col_types = paste0(rep(&quot;c&quot;, 13), collapse = &quot;&quot;),
                               locale = locale(encoding = &quot;ISO-8859-1&quot;)
                               )

# filter and show parameters
tempelhof_params %&gt;%
    select(2:7) %&gt;% 
    filter(!duplicated(Parameter) &amp; !is.na(Parameter)) %&gt;% 
    knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Von_Datum</th>
<th align="left">Bis_Datum</th>
<th align="left">Stationsname</th>
<th align="left">Parameter</th>
<th align="left">Parameterbeschreibung</th>
<th align="left">Einheit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">19740101</td>
<td align="left">19741231</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">FM</td>
<td align="left">Tagesmittel der Windgeschwindigkeit m/s Messnetz 3</td>
<td align="left">m/sec</td>
</tr>
<tr class="even">
<td align="left">19740101</td>
<td align="left">19741231</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">FX</td>
<td align="left">Maximum der Windspitze Messnetz 3</td>
<td align="left">m/sec</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">NM</td>
<td align="left">Tagesmittel des Bedeckungsgrades</td>
<td align="left">Achtel</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">PM</td>
<td align="left">Tagesmittel des Luftdrucks</td>
<td align="left">hpa</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">RSK</td>
<td align="left">tgl. Niederschlagshoehe</td>
<td align="left">mm</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">RSKF</td>
<td align="left">tgl. Niederschlagsform (=Niederschlagshoehe_ind)</td>
<td align="left">nummerischer Code</td>
</tr>
<tr class="odd">
<td align="left">19701117</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">SDK</td>
<td align="left">tgl. Sonnenscheindauer</td>
<td align="left">Stunde</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">SHK_TAG</td>
<td align="left">Schneehoehe Tageswert</td>
<td align="left">cm</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">TGK</td>
<td align="left">Minimum der Lufttemperatur am Erdboden in 5cm Hoehe</td>
<td align="left">°C</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">TMK</td>
<td align="left">Tagesmittel der Temperatur</td>
<td align="left">°C</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">TNK</td>
<td align="left">Tagesminimum der Lufttemperatur in 2m Hoehe</td>
<td align="left">°C</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">TXK</td>
<td align="left">Tagesmaximum der Lufttemperatur in 2m Höhe</td>
<td align="left">°C</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">UPM</td>
<td align="left">Tagesmittel der Relativen Feuchte</td>
<td align="left">%</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">VPM</td>
<td align="left">Tagesmittel des Dampfdruckes</td>
<td align="left">hpa</td>
</tr>
</tbody>
</table>
<div id="tidying-the-data" class="section level3">
<h3>Tidying the Data</h3>
<p>There are a couple more changes to be made before I can start visualizing. First, <a href="https://www.tidyverse.org/">tidyverse</a> magic works most potently on <em>long</em> data, but the DW uses <em>wide</em> format (<a href="https://en.wikipedia.org/wiki/Wide_and_narrow_data">see the difference here</a>). Second, the variable abbreviations are hard to understand (FM, RSK, etc.), so I should replace them with something else. Third and last, I now have four datasets, one for each Berlin weather station, but one would be preferable.</p>
<p>I’ll change the variable names using the following map.</p>
<pre class="r"><code>var_names &lt;- c(&quot;Date&quot; = &quot;MESS_DATUM&quot;,
               &quot;Avg. Wind Speed (m/sec)&quot; = &quot;FM&quot;,
               &quot;Max Wind Speed (m/sec)&quot; = &quot;FX&quot;,
               &quot;Avg. Cloud Cover (8th)&quot; = &quot;NM&quot;,
               &quot;Avg. Air Pressure (hPa)&quot; = &quot;PM&quot;,
               &quot;Precipitation (mm)&quot; = &quot;RSK&quot;,
               &quot;Sun Shine Duration (h)&quot; = &quot;SDK&quot;,
               &quot;Snow (cm)&quot; = &quot;SHK_TAG&quot;,
               &quot;Avg. Temp. (°C)&quot; = &quot;TMK&quot;,
               &quot;Min. Temp. (°C)&quot; = &quot;TNK&quot;,
               &quot;Max Temp. (°C)&quot; = &quot;TXK&quot;,
               &quot;Avg. Humidity (%)&quot; = &quot;UPM&quot;
               )</code></pre>
<p>The following <code>tidy_data</code> function reduces each data frame to the set of variables I’m interested in, converts the character strings to numbers and dates, and <code>gathers</code> the variables into long format.</p>
<pre class="r"><code>tidy_data &lt;- function(df, vars, station_name){
    df &lt;- select(df, vars)
    df &lt;- as_tibble(sapply(df, as.double))
    df$Date &lt;- ymd(df$Date)
    df &lt;- gather(df, key = &quot;Variable&quot;, value = &quot;Value&quot;, 2:12)
    df$Station &lt;- station_name
    df
}</code></pre>
<p>I can now call <code>tidy_data</code> for each station, and then combine the station data into one data frame <code>berlin_data</code>.</p>
<pre class="r"><code># call tidy_data for each station dataset
dahlem_lfag_data &lt;- tidy_data(dahlem_lfag_data, var_names, &quot;Dahlem (LFAG)&quot;)
dahlem_fu_data &lt;- tidy_data(dahlem_fu_data, var_names, &quot;Dahlem (FU)&quot;)
tegel_data &lt;- tidy_data(tegel_data, var_names, &quot;Tegel&quot;)
tempelhof_data &lt;- tidy_data(tempelhof_data, var_names, &quot;Tempelhof&quot;)

# combine station data into one data frame
berlin_data &lt;- rbind(dahlem_lfag_data, dahlem_fu_data, tegel_data, tempelhof_data)</code></pre>
<p>There’s just one final change I’d like to make: The values reflect daily averages, and measurement began in the 19th century for some stations, so I’m faced with hundreds of thousands of observations! To make things more manageable I’ll include different time scales, e.g. years, months, weeks, days, and <a href="https://en.wikipedia.org/wiki/Season#Meteorological">meteorological seasons</a>. While I’m at it I’ll also convert months and seasons to factors.</p>
<pre class="r"><code># add years, months, weeks, days, and seasons
berlin_data &lt;- berlin_data %&gt;% 
    mutate(Year = year(Date),
           Month = month(Date),
           Week = week(Date),
           Day = day(Date),
           Season = case_when(Month %in% c(12, 1, 2) ~ &quot;Winter&quot;,
                              Month %in% 3:5 ~ &quot;Spring&quot;,
                              Month %in% 6:8 ~ &quot;Summer&quot;,
                              Month %in% 9:11 ~ &quot;Fall&quot;,
                              )
           )

# turn seasons into factors
berlin_data$Season &lt;- factor(berlin_data$Season,
                             ordered = T,
                             levels = c(&quot;Spring&quot;, &quot;Summer&quot;, &quot;Fall&quot;, &quot;Winter&quot;)
                             )
berlin_data$Station &lt;- factor(berlin_data$Station,
                             ordered = T,
                             levels = c(&quot;Dahlem (LFAG)&quot;, &quot;Dahlem (FU)&quot;, &quot;Tempelhof&quot;, &quot;Tegel&quot;)
                             )

# turn months into factors
berlin_data$Month &lt;- factor(berlin_data$Month,
                            ordered = T,
                            levels = 1:12,
                            labels = c(&quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;,
                                       &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, 
                                       &quot;September&quot;, &quot;October&quot;, &quot;November&quot;,
                                       &quot;December&quot;
                                       )
                            )</code></pre>
<hr />
</div>
</div>
<div id="visualizing-climate-change-in-berlin" class="section level2">
<h2>Visualizing Climate Change in Berlin</h2>
<p>I now have a few hundred thousand observations for each of four Berlin weather stations, which I can freely group based on my analytical needs. The following table shows the total observations (daily averages) for each of Berlin’s four weather stations.</p>
<pre class="r"><code>berlin_data %&gt;% 
    group_by(Station) %&gt;% 
    summarise(&quot;number of observations&quot; = n()) %&gt;% 
    knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Station</th>
<th align="right">number of observations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Dahlem (LFAG)</td>
<td align="right">347446</td>
</tr>
<tr class="even">
<td align="left">Dahlem (FU)</td>
<td align="right">273207</td>
</tr>
<tr class="odd">
<td align="left">Tempelhof</td>
<td align="right">281248</td>
</tr>
<tr class="even">
<td align="left">Tegel</td>
<td align="right">220979</td>
</tr>
</tbody>
</table>
<p>Let’s first take a look at how average annual temperatures have changed since 1876. The following time series shows how temperatures in Berlin have increased by about 2°C, with the rate of warming accelerating from about the middle of the last century. There is some variation, but the general trend is unmistakable.</p>
<pre class="r"><code># create variable to hold theme (reusable)
thm &lt;- theme_minimal() + 
    theme(panel.grid.minor = element_blank(),
          panel.grid.major.x = element_blank()
          )

# generate combined timeseries of temperatur data
berlin_data %&gt;% 
    filter(Variable == &quot;Avg. Temp. (°C)&quot;) %&gt;%
    group_by(Station, Year) %&gt;% 
    summarise(Value = mean(Value, na.rm = T)) %&gt;%
    ggplot(aes(x = Year, y = Value)) +  
    geom_line(aes(color = Station)) +
    scale_color_manual(values = c(&quot;#000000&quot;, &quot;#000090&quot;, &quot;#4848ED&quot;, &quot;#8888FF&quot;)) +
    geom_smooth(se = F, method = &quot;loess&quot;, span = .2, color = &quot;#FF0000&quot;) +
    labs(title = &quot;Avg. Yearly Temperature (°C), 1876-2017&quot;,
         y = &quot;Temp.&quot;
         ) +
    thm +
    scale_x_continuous(limits = c(1876, 2017),
                       breaks = seq(1877, 2017, by = 10)
                       ) +
    scale_y_continuous(limits = c(3, 12),
                       breaks = seq(3, 12, by = 1)
                       )</code></pre>
<p><img src="/blog/2018-09-17-how-about-that-weather-an-eda-of-climate-change-in-berlin_files/figure-html/viz%20mean%20yearly%20temps-1.png" width="672" /></p>
<p>Also conspicuous is the precipitous drop in 1945. Histograms of each year from 1941-1949 reveal bimodal distributions of daily temperatures for most years. One mode is missing from 1945, that is to say, some data is missing, and the data that is available clusters around the low end.</p>
<pre class="r"><code>berlin_data %&gt;% 
    filter(Station == &quot;Dahlem (LFAG)&quot;,
           Variable == &quot;Avg. Temp. (°C)&quot;,
           Year %in% 1941:1949,
           !is.na(Value)
           ) %&gt;% 
    ggplot(aes(x = Value)) + 
    geom_histogram(bins = 30) +
    facet_wrap(~Year) + 
    theme_minimal() + 
    theme(panel.grid.minor = element_blank(),
          panel.grid.major.x = element_blank(),
          panel.spacing = unit(2, &quot;lines&quot;)
          ) +
    labs(title = &quot;Distribution of Annual Temperatures (°C), 1941-1949&quot;,
         x = &quot;Temperature&quot;
         )</code></pre>
<p><img src="/blog/2018-09-17-how-about-that-weather-an-eda-of-climate-change-in-berlin_files/figure-html/viz%20distribution%20of%20temps%201941-1949-1.png" width="672" /></p>
<p>A table observation counts (i.e. number of daily averages) confirms that 1945 is missing data.</p>
<pre class="r"><code>berlin_data %&gt;% 
    filter(Station == &quot;Dahlem (LFAG)&quot;,
           Variable == &quot;Avg. Temp. (°C)&quot;,
           Year %in% 1941:1949,
           !is.na(Value)
           ) %&gt;% 
    group_by(Year) %&gt;% 
    summarize(&quot;number of obs.&quot; = n(),
              &quot;annual avg. temp.&quot; = mean(Value)) %&gt;% 
    knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Year</th>
<th align="right">number of obs.</th>
<th align="right">annual avg. temp.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1941</td>
<td align="right">365</td>
<td align="right">7.714247</td>
</tr>
<tr class="even">
<td align="right">1942</td>
<td align="right">365</td>
<td align="right">7.910685</td>
</tr>
<tr class="odd">
<td align="right">1943</td>
<td align="right">365</td>
<td align="right">9.704110</td>
</tr>
<tr class="even">
<td align="right">1944</td>
<td align="right">366</td>
<td align="right">9.407104</td>
</tr>
<tr class="odd">
<td align="right">1945</td>
<td align="right">170</td>
<td align="right">3.472353</td>
</tr>
<tr class="even">
<td align="right">1946</td>
<td align="right">365</td>
<td align="right">9.191233</td>
</tr>
<tr class="odd">
<td align="right">1947</td>
<td align="right">365</td>
<td align="right">8.942740</td>
</tr>
<tr class="even">
<td align="right">1948</td>
<td align="right">366</td>
<td align="right">9.934153</td>
</tr>
<tr class="odd">
<td align="right">1949</td>
<td align="right">365</td>
<td align="right">9.959726</td>
</tr>
</tbody>
</table>
<p>The <a href="https://en.wikipedia.org/wiki/Battle_of_Berlin">Battle of Berlin</a> was in the spring of 1945, so there’s really no question as to why the data is missing. I could go to the trouble of interpolating values from the flanking years, but I’ll save myself some time and just drop 1945 instead, which shouldn’t have any effect on the overall trend. I’ll also aggregate the station data to make later visualizations a little easier.</p>
<pre class="r"><code>berlin_data &lt;- berlin_data &lt;- filter(berlin_data, Year != 1945) %&gt;% 
    group_by(Year, Month, Week, Day, Season, Date, Variable) %&gt;% 
    summarise(Value = mean(Value, na.rm = T)) %&gt;% 
    ungroup()</code></pre>
<p>The next chart compares changes in Berlin’s average yearly temperature with global temperature shifts. First, I need to download some data of global historical temperatures from <a href="https://climate.nasa.gov/vital-signs/global-temperature/">NASA</a>.</p>
<pre class="r"><code>nasa_data &lt;- read_tsv(&quot;https://climate.nasa.gov/system/internal_resources/details/original/647_Global_Temperature_Data_File.txt&quot;,
                      col_names = c(&quot;Year&quot;, &quot;World&quot;, &quot;lowess&quot;),
                      col_types = &quot;idd&quot;
                      )</code></pre>
<p>I can then combine the NASA data with the Berlin data and visualize them together. The following graph shows the trend in global mean temperatures compared to Berlin. Note that the y-axis displays average annual temperature <em>change</em> in °C, and <em>not</em> average annual temperature. What I call change NASA calls <strong>annual average anomaly</strong>, which is the “change in global surface temperature relative to 1951-1980 average temperatures”. To maintain consistency with NASA’s data I’ll also transform the Berlin data to also represent the change from the 1951-1980 average. Also note that I plot Loess curves with <code>span = 0.2</code> to cut out some of the noise.</p>
<pre class="r"><code>berlin_data %&gt;%
    filter(Variable == &quot;Avg. Temp. (°C)&quot;,
           ) %&gt;%
    group_by(Year) %&gt;%
    summarise(Value = mean(Value, na.rm = T)) %&gt;%
    
    # put Berlin data in relation to 1951-1980 average
    mutate(Berlin = Value - mean(filter(.data = .,
                                        Year %in% 1951:1980
                                        )[[&quot;Value&quot;]]
                                 )
           ) %&gt;%  
    right_join(nasa_data, by = &quot;Year&quot;) %&gt;%
    select(Year, Berlin, World) %&gt;%
    filter(!is.na(Berlin), !is.na(World)) %&gt;% 
    
    # loess transform
    mutate(Berlin = predict(loess(Berlin ~ Year, data = ., span = 0.2)),
           World = predict(loess(World ~ Year, data = ., span = 0.2))
           ) %&gt;% 
    
    # tidy and plot
    gather(key = &quot;Scope&quot;, value = &quot;Value&quot;, 2:3) %&gt;%
    ggplot(aes(x = Year, y= Value)) +
    geom_line(aes(color = Scope), size = 1) +
    geom_hline(yintercept = 0, linetype = 8) +
    thm + 
    scale_x_continuous(limits = c(1876, 2017),
                       breaks = seq(1877, 2017, by = 10)
                       ) +
    scale_y_continuous(limits = c(-1, 2),
                       breaks = seq(-1, 2, .5)) +
    scale_color_manual(values = c(&quot;red&quot;, &quot;blue&quot;)) +
    labs(color = &quot;&quot;,
         title = &quot;Annual Avg. Anomaly (LOESS), World vs. Berlin, 1877-2017&quot;,
         y = &quot;Change (°C)&quot;
         )</code></pre>
<p><img src="/blog/2018-09-17-how-about-that-weather-an-eda-of-climate-change-in-berlin_files/figure-html/viz%20global%20and%20local%20temp%20change-1.png" width="672" /></p>
<p>The upward trend in mean annual temperatures in Berlin broadly parallels that of the global aggregate. Interestingly, temperatures seem to be increasing faster in Berlin: average annual temperature has increased by about 2°C since 1925, compared to 1°C globally. This is likely due to the <a href="https://en.wikipedia.org/wiki/Urban_heat_island">urban heat island effect</a>, and would be worth exploring in future analyses.</p>
<div id="proportion-of-25c-days" class="section level3">
<h3>Proportion of +25°C Days</h3>
<p>Next, I would like to see how the increase in average annual temperatures has affected the high end of the overall distribution of annual temperatures. The following bit of code just stores some useful, reusable settings.</p>
<pre class="r"><code>filter_group &lt;- function(df){
    df %&gt;% filter(Year %in% (1957:2017)) %&gt;%
    group_by(Year, Season, Month)
    }
    
gg_geoms_x_scale &lt;- function(df){
    df %&gt;% ggplot(aes(x = Year, y = Value, color = Season)) +
        geom_line(alpha = .5) +
        geom_smooth(method = &quot;loess&quot;, se = F) +
        scale_color_manual(values = c(&quot;#FF9F9F&quot;, &quot;#E50000&quot;, &quot;#7777FF&quot;, &quot;#0000C4&quot;)) +
        scale_x_continuous(limits = c(1957, 2017),
                           breaks = seq(1957, 2017, by = 10)
                           ) +
        facet_wrap(~ Month)
}

thm &lt;- thm + 
    theme(panel.spacing = unit(1, &quot;lines&quot;))</code></pre>
<p>Now to plot the <em>proportion</em> of days per month, for the months May-September, where maximum temperatures exceed 25°C. The colors correspond to <a href="https://en.wikipedia.org/wiki/Season#Meteorological">meteorological season</a>, with spring and summer being shades of red, and fall and winter shades of blue.</p>
<pre class="r"><code>berlin_data %&gt;% 
    filter(Variable == &quot;Max Temp. (°C)&quot;
           ) %&gt;%
    filter_group() %&gt;% 
    summarise(Value = sum(Value &gt; 25)/n()) %&gt;% 
    gg_geoms_x_scale() +
    scale_y_continuous(limits = c(-0.5, 1),
                       breaks = seq(0, 1, by = .1)
                       ) +
    thm +
    labs(title = &quot;Proportion of Days with Temp. &gt; 25°C, 1957-2017&quot;,
         y = &quot;Proportion&quot;
         )</code></pre>
<p><img src="/blog/2018-09-17-how-about-that-weather-an-eda-of-climate-change-in-berlin_files/figure-html/temperatures%20greater%20that%2025C-1.png" width="960" /></p>
<p>Predictably, the proportion of days with maximum temperatures above 25°C has gone up since 1957, particularly in July and August, but also in May and September. The summer months show a great deal of variation. Also interesting is the fact that June has remained fairly stable even as other months show dramatic increases. This could provide one explanation, via a sort of <a href="https://en.wikipedia.org/wiki/Contrast_effect">contrast effect</a>, for the perception that June’s weather is getting worse, although I’m not so sure this</p>
</div>
<div id="sunshine" class="section level3">
<h3>Sunshine</h3>
<p>Looking at the next plot, the average number of hours of daily sunshine appears to have remained fairly stable at least since 1977. There is some fluctuation, but there is no clear trend in any direction. I take this to mean that these months have not become significantly more overcast (or, conversely, sunnier) - at least, not over the long term.</p>
<pre class="r"><code>berlin_data %&gt;% 
    filter(Variable == &quot;Sun Shine Duration (h)&quot;) %&gt;%
    filter_group() %&gt;% 
    summarize(Value = mean(Value)) %&gt;% 
    gg_geoms_x_scale() +
    scale_y_continuous(limits = c(0, 12.5),
                       breaks = seq(0, 12, by = 1)
                       ) +
    facet_wrap(~ Month) +
    thm +
    labs(title = &quot;Avg. Daily Sunshine (Hours), 1957-2017&quot;,
         y= &quot;Duration (h)&quot;
         )</code></pre>
<p><img src="/blog/2018-09-17-how-about-that-weather-an-eda-of-climate-change-in-berlin_files/figure-html/avg.%20daily%20sunshine%20by%20month-1.png" width="960" /></p>
</div>
<div id="precipitation" class="section level3">
<h3>Precipitation</h3>
<p>For the most part the average amount of precipitation also doesn’t show any general upward trend since 1957. At shorter timescales, however, and for individual months, there are discernible trends. June and July - and to a lesser degree, October - show a clear increase in the amound of precipitation.</p>
<pre class="r"><code>berlin_data %&gt;% 
    filter(Variable == &quot;Precipitation (mm)&quot;) %&gt;%
    filter_group() %&gt;% 
    summarize(Value = mean(Value)) %&gt;% 
    gg_geoms_x_scale() + 
    scale_y_continuous(limits = c(0, 8),
                       breaks = seq(0, 8, by = 1)) +
    facet_wrap(~ Month) +
    thm + 
    labs(title = &quot;Avg. Daily Precipitation (mm), 1957-2017&quot;,
         y= &quot;Amount (mm)&quot;
         )</code></pre>
<p><img src="/blog/2018-09-17-how-about-that-weather-an-eda-of-climate-change-in-berlin_files/figure-html/avg.%20daily%20precipitation%20by%20month-1.png" width="960" /></p>
</div>
<div id="days-without-precipitation" class="section level3">
<h3>Days Without Precipitation</h3>
<p>Changes in the proportion of “wet” to “dry” days since 1957 depend on the timescale used, as well as the month being analyzed.</p>
<pre class="r"><code>berlin_data %&gt;% 
    filter(Variable == &quot;Precipitation (mm)&quot;) %&gt;%
    filter_group() %&gt;% 
    summarize(Value = sum(Value == 0)/n()) %&gt;% 
    gg_geoms_x_scale() + 
    scale_y_continuous(limits = c(0, 1),
                       breaks = seq(0, 1, by = .1)) +
    thm +
    labs(title = &quot;Days Without Precipitation as Proportion of all Days, 1957-2017&quot;,
         y= &quot;Proportion&quot;
         )</code></pre>
<p><img src="/blog/2018-09-17-how-about-that-weather-an-eda-of-climate-change-in-berlin_files/figure-html/proportion%20days%20without%20precipitation%20by%20month-1.png" width="960" /></p>
</div>
<div id="air-pressure" class="section level3">
<h3>Air Pressure</h3>
<p>Given what I know about the dynamic between air pressure and weather - which is admittedly not that much - I think air pressure could be a further indicator of storm intensity. As I understand it, stable high pressure zones usually indicate good weather while rapidly decreasing air pressure indicates an impending storm. Hourly data are necessary to properly analyze the association between air pressure and bad weather, something I decided against for the this analysis for time reasons. Still, I assume strong storms would leave some trace by driving down daily averages.</p>
<p>To see if air pressure, measured in hectopascals (hPa), is a good indicator of weather conditions, I’ll plot the correlations of some relevant variables in a correlogram. I should note that this probably isn’t the best method to determine how air pressure affects weather. It’s more of a heuristic to help me determine if there is a question here worth answering. Finer-grained air pressure data and variables more closely associated with bad weather, cloud type for instance, in addition to more rigorous statistical methods would allow me to more confidently draw conclusions. But that’s a project for another day.</p>
<p>First I need to compute a correlation matrix, which requires some transformation. This code <em>widens</em> the data by giving each variable it’s own column (basically the reverse of the above <em>tidying</em> process), and then computes the correlations (Spearman’s <span class="math inline">\(\rho\)</span> in this case).</p>
<pre class="r"><code>berdat_sub &lt;- berlin_data %&gt;%
    filter(Month %in% c(&quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;),
           Year &gt; 1956) %&gt;%
    spread(Variable, Value) %&gt;% 
    select(7:17, -`Snow (cm)`, -`Avg. Cloud Cover (8th)`)

names(berdat_sub) &lt;- c(&quot;PRESS&quot;, &quot;HUMID&quot;, &quot;TEMP_AVG&quot;, &quot;WIND_AVG&quot;, &quot;TEMP_MAX&quot;,
                       &quot;WIND_MAX&quot;, &quot;TEMP_MIN&quot;, &quot;PRECIP&quot;, &quot;SUN&quot;)

berdat_cortest &lt;- corr.test(x = berdat_sub, method = &quot;spearman&quot;)</code></pre>
<p>I’ll use a matrix of p-values, conveniently calculated by the <code>psych</code> library’s <code>corr.test</code> function, to test for the statistical significance of the individual correlations, as even low correlation can hint at so sort of association. The significance level is set to <span class="math inline">\(\alpha\)</span> = 0.001. (<strong>Note</strong>: An outcome is “statistically significant” when the probability of a chance occurence, given by a p-value, is less than <span class="math inline">\(\alpha\)</span>, i.e. <em>very</em> small.)</p>
<pre class="r"><code>corrplot(berdat_cortest$r,
         p.mat = berdat_cortest$p,
         sig.level = .001,
         type = &quot;upper&quot;,
         method = &quot;number&quot;,
         order = &quot;AOE&quot;,
         tl.cex = .8,
         title = &quot;Correlogram (rho) of Selected Variables&quot;,
         mar = c(0, 0, 2, 0),
         col = colorRampPalette(c(&quot;red&quot;, &quot;white&quot;, &quot;blue&quot;))(100)
         )</code></pre>
<p><img src="/blog/2018-09-17-how-about-that-weather-an-eda-of-climate-change-in-berlin_files/figure-html/correlogram%20of%20selected%20variables-1.png" width="672" /></p>
<p>Of particular interest are correlations between <code>PRESS</code> and the other variables that also make intuitive sense, as that would imply that air pressure is a good predictor of weather conditions. We should expect, for example, that high pressure is positively correlated with fair weather, as given by <code>SUN</code>, and negatively correlated with wind and bad weather, as given by <code>WIND_MAX</code>, <code>WIND_AVG</code>, and <code>PRECIP</code>. Looking at the plot, this seems to be the case, so I’ll accept, with the above proviso, that a day’s average air pressure can tell me something about the weather conditions for that day.</p>
<p>The final plot displays the number of days per month where there is at least a -3 hPa <em>drop</em> in air pressure compared to the previous day. Although this measure is obviously not perfect, my layperson intuition tells me that an increase in the number of such drops might hint at an increase in storm fronts of a certain intensity.</p>
<p>The choice of a -3 hPa drop is not completely arbitrary. A convenient table on <a href="http://www.bohlken.net/airpressure2.htm">bohlken.net</a> (a barograph maker) states that a drop of -3 hPa can lead to strong winds of 6-7 Bfts (11-17 m/s), so it seems like a decent place to start.</p>
<p>The final plot contains the number of days per month with a difference of at least -3 hPa compared to the previous day. There are at least two major problems here: First, the table on bohlken.net relates wind speed increases to a drop in air pressure over a 1-3 hour timeframe, while the data I’m using contains 24-hour means. Second, there is an implicit assumption that bad weather days and good weather days are more or less evenly dispersed, as there wouldn’t otherwise be any difference between consecutive days of the same type. This is very likely not the case.</p>
<p>Still, I’m fairly confident that larger, more extreme storm fronts would leave a trace on daily hPa averages, and that an increase in the amount or intensity of these fluctuations is measurable. I also think that severe weather is still infrequent enough in Berlin that an increasing number of large drops should show up in monthly aggregates.</p>
<p>The plot below seems to confirm my intuitions. Especially the months May-August show strong upward trends over the last 10-15 years, which one might interpret as an increase in the number of storms of a certain magnitude. This is also consistent with my understanding of how temperature, air pressure, and storm systems relate: The warmer the air, the more water vapor it contains, and the more intense the resulting storms.</p>
<pre class="r"><code>berlin_data %&gt;% 
    filter(Variable == &quot;Avg. Air Pressure (hPa)&quot;) %&gt;% 
    filter_group() %&gt;% 
    mutate(Value = (Value - lag(Value))) %&gt;%
    filter(!is.na(Value), Value &lt; -3) %&gt;%
    group_by(Year, Season, Month) %&gt;%
    summarize(Value = n()) %&gt;%
    gg_geoms_x_scale() + 
    facet_wrap(~ Month) +
    scale_y_continuous(limits = c(2, 15),
                       breaks = seq(2, 15, by = 1)
                       ) +
    thm + 
    labs(title = &quot;Drop in Air Pressure (hPa) from Previous Day &gt; 3&quot;,
         y= &quot;Number of Days&quot;
         )</code></pre>
<p><img src="/blog/2018-09-17-how-about-that-weather-an-eda-of-climate-change-in-berlin_files/figure-html/drop%20in%20air%20pressure%20greater%20than%20-3-1.png" width="960" /></p>
</div>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>If there is one conclusion that I can confidently draw from the above analysis, it is that Berlin is getting warmer at a rate on par with global average. It is also <a href="https://earthobservatory.nasa.gov/Features/ClimateStorms/page2.php">well known</a> that temperature has an effect on weather systems generally, and storm intensity specifically. In an attempt to find some evidence of such a development in Berlin I analysed temperature, including the number of days per month with highs over 25°C, the average amount of monthly precipitation, the proportion of “dry” to “wet” days, and air pressure shifts as in indication of increasing storm intensity and frequency.</p>
<p>Taken together, these variables <em>suggest</em> that Berlin is experiencing a 10 to 20 year trend of more extreme weather: Hotter summers punctuated by more intense summer storms. I’ve deduced this from the following:</p>
<ul>
<li>Average precipitation has increased without a corresponding increase in the proportion of days with precipitation to those without.</li>
<li>Daily averages of sunshine duration have, much like the the number of rainless days, remained fairly stable.</li>
<li>There is a consistent increase in the number of monthly drops in air pressure of a magnitude greater than 3 hPa.</li>
</ul>
<p>None</p>
</div>

                <br>
                
                  <div class="tags">
                    <strong>Tags:</strong>
                  
                    <a href="/tags/berlin">Berlin</a>
                  
                    <a href="/tags/climate">climate</a>
                  
                    <a href="/tags/eda">EDA</a>
                  
                  </div>
                  <br />
                
                <p class="back-to-posts"><a href="/blog">Back to posts</a></p>
            </div>
            <br>
            <div class="disqus">
                <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "gershomtripp-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            
        </div>
    </div>
</section>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-123-45', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  

  <script type="text/javascript">
    hljs.initHighlightingOnLoad();
  </script>





</body>
</html>

