<!DOCTYPE html>
<html lang="en-US">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="author" content="Gershom Tripp">
<meta name="description" content="Introduction This post is inspired by the frequent conversations I’ve had, or heard, about Berlin’s “worsening” climate.
 Cleaning the data The data is a subset of the Deutscher Wetterdienst’s extensive repository of weather data. It’s possible to get hourly averages, going back decades, but I decided daily averages were enough for this analysis. I downloaded the data as four ZIPs (from four Berlin weather stations), extracted the TXT/CSV files, renamed them to something more descriptive, and wrote some code to remove some excess white space that was interfering with the data import.">

<meta property="og:title" content="A brief analysis of Berlin’s changing climate." />
<meta property="og:description" content="Introduction This post is inspired by the frequent conversations I’ve had, or heard, about Berlin’s “worsening” climate.
 Cleaning the data The data is a subset of the Deutscher Wetterdienst’s extensive repository of weather data. It’s possible to get hourly averages, going back decades, but I decided daily averages were enough for this analysis. I downloaded the data as four ZIPs (from four Berlin weather stations), extracted the TXT/CSV files, renamed them to something more descriptive, and wrote some code to remove some excess white space that was interfering with the data import." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/a-brief-analysis-of-berlin-s-changing-climate/" /><meta property="article:published_time" content="2018-09-13T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2018-09-13T00:00:00&#43;00:00"/>

<title>


     A brief analysis of Berlin’s changing climate. 

</title>
<link rel="canonical" href="/blog/a-brief-analysis-of-berlin-s-changing-climate/">







<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/default.min.css">




<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500">



    
    <link rel="stylesheet" href="/css/reset.css?t=2018-09-13%2020%3a23%3a50.384899%20%2b0200%20CEST%20m%3d%2b0.141863684">
    <link rel="stylesheet" href="/css/pygments.css?t=2018-09-13%2020%3a23%3a50.384899%20%2b0200%20CEST%20m%3d%2b0.141863684">
    <link rel="stylesheet" href="/css/main.css?t=2018-09-13%2020%3a23%3a50.384899%20%2b0200%20CEST%20m%3d%2b0.141863684">
    
        <link rel="stylesheet" href="/css/override.css?t=2018-09-13%2020%3a23%3a50.384899%20%2b0200%20CEST%20m%3d%2b0.141863684">
    




<link rel="shortcut icon"

    href="/img/leaf.ico"

>








</head>


<body lang="en">

<section class="header">
    <div class="container">
        <div class="content">
            
                
                
                
                
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                
                <a href="/"><img class="avatar" src="/img/profile-4x.png" srcset="/img/profile-4x.png 1x"></a>
            
            <a href="/"><div class="name">Gershom Tripp</div></a>
            
            <nav>
                <ul>
                    
                        <li class="nav-blog"><a href="/blog/"><span>Blog</span></a></li>
                    
                        <li class="nav-about"><a href="/about/"><span>About</span></a></li>
                    
                </ul>
            </nav>
        </div>
    </div>
</section>

<section class="icons">
    <div class="container">
        <div class="content">
        
            <a href="//github.com/GershTri" target="_blank" rel="noopener"><img class="icon" src="/img/github.svg" alt="github" /></a>
        

        

        
            <a href="//twitter.com/ppirtmohsreg" target="_blank" rel="noopener"><img class="icon" src="/img/twitter.svg" alt="twitter" /></a>
        

	

        

        

        
            <a href="//linkedin.com/in/gershomtripp" target="_blank" rel="noopener"><img class="icon" src="/img/linkedin.svg" alt="linkedin" /></a>
        

        

        

        

        

        
            <a href="mailto:gershtripp@gmail.com"><img class="icon" src="/img/email.svg" alt="email" /></a>
        

        

        
        </div>
    </div>
</section>


<section class="main post non-narrow zero-top-spacing">
    <div class="container">
        <div class="content">
            <div class="front-matter">
                <div class="title-container">
                    <div class="page-heading">

    A brief analysis of Berlin’s changing climate.

</div>

                    <div class="initials"><a href="/">ad</a></div>
                </div>
                <div class="meta">
                    
                    <div class="date" title='Thu Sep 13 2018 00:00:00 UTC'>Sep 13, 2018</div>
                    
                    
		    <div class="reading-time"><div class="middot"></div>5 minutes read</div>
                    
                </div>
            </div>
            <div class="markdown">
                <div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>This post is inspired by the frequent conversations I’ve had, or heard, about Berlin’s “worsening” climate.</p>
</div>
<div id="cleaning-the-data" class="section level3">
<h3>Cleaning the data</h3>
<p>The data is a subset of the <a href="https://www.dwd.de/DE/Home/home_node.html">Deutscher Wetterdienst</a>’s extensive repository of weather data. It’s possible to get hourly averages, going back decades, but I decided daily averages were enough for this analysis. I downloaded the data as four ZIPs (from four Berlin weather stations), extracted the TXT/CSV files, renamed them to something more descriptive, and wrote some code to remove some excess white space that was interfering with the data import.</p>
<p>The data files are semicolon-delimited. To keep things simple I’ll import everything as character strings. Numeric and date objects are converted later, as needed. The value <code>-999</code> is imported as <code>NA</code>.</p>
<p>It makes sense to take a look at the included parameter files to get an idea what kind of data I’m working with. These are in German (umlauts!), so I’ll use <code>guess_encoding()</code> from the <code>readr</code> library to figure out which ISO I need.</p>
<pre class="r"><code>guess_encoding(&quot;datasets/berlin_climate_data/Dahlem-(FU)-params.txt&quot;) %&gt;% 
    knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">encoding</th>
<th align="right">confidence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ISO-8859-1</td>
<td align="right">0.64</td>
</tr>
<tr class="even">
<td align="left">ISO-8859-9</td>
<td align="right">0.27</td>
</tr>
<tr class="odd">
<td align="left">ISO-8859-2</td>
<td align="right">0.24</td>
</tr>
</tbody>
</table>
<p>ISO-8859-1 it is. I don’t care too much about the details of each station, so I’ll just import one file, <code>Tempelhof-params.txt</code>, to gain some insight into the parameters, i.e. abbreviations, units used, etc.</p>
<pre class="r"><code># load parameter file
data_path &lt;- file.path(&quot;datasets&quot;, &quot;berlin_climate_data&quot;, &quot;Tempelhof-params.txt&quot;)
tempelhof_params &lt;- read_delim(file = data_path,
                               delim = &quot;;&quot;,
                               col_types = paste0(rep(&quot;c&quot;, 13), collapse = &quot;&quot;),
                               locale = locale(encoding = &quot;ISO-8859-1&quot;)
                               )

# filter and show parameters
tempelhof_params %&gt;%
    select(2:7) %&gt;% 
    filter(!duplicated(Parameter) &amp; !is.na(Parameter)) %&gt;% 
    knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Von_Datum</th>
<th align="left">Bis_Datum</th>
<th align="left">Stationsname</th>
<th align="left">Parameter</th>
<th align="left">Parameterbeschreibung</th>
<th align="left">Einheit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">19740101</td>
<td align="left">19741231</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">FM</td>
<td align="left">Tagesmittel der Windgeschwindigkeit m/s Messnetz 3</td>
<td align="left">m/sec</td>
</tr>
<tr class="even">
<td align="left">19740101</td>
<td align="left">19741231</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">FX</td>
<td align="left">Maximum der Windspitze Messnetz 3</td>
<td align="left">m/sec</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">NM</td>
<td align="left">Tagesmittel des Bedeckungsgrades</td>
<td align="left">Achtel</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">PM</td>
<td align="left">Tagesmittel des Luftdrucks</td>
<td align="left">hpa</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">RSK</td>
<td align="left">tgl. Niederschlagshoehe</td>
<td align="left">mm</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">RSKF</td>
<td align="left">tgl. Niederschlagsform (=Niederschlagshoehe_ind)</td>
<td align="left">nummerischer Code</td>
</tr>
<tr class="odd">
<td align="left">19701117</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">SDK</td>
<td align="left">tgl. Sonnenscheindauer</td>
<td align="left">Stunde</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">SHK_TAG</td>
<td align="left">Schneehoehe Tageswert</td>
<td align="left">cm</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">TGK</td>
<td align="left">Minimum der Lufttemperatur am Erdboden in 5cm Hoehe</td>
<td align="left">°C</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">TMK</td>
<td align="left">Tagesmittel der Temperatur</td>
<td align="left">°C</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">TNK</td>
<td align="left">Tagesminimum der Lufttemperatur in 2m Hoehe</td>
<td align="left">°C</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">TXK</td>
<td align="left">Tagesmaximum der Lufttemperatur in 2m Höhe</td>
<td align="left">°C</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">UPM</td>
<td align="left">Tagesmittel der Relativen Feuchte</td>
<td align="left">%</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">VPM</td>
<td align="left">Tagesmittel des Dampfdruckes</td>
<td align="left">hpa</td>
</tr>
</tbody>
</table>
</div>
<div id="tidying-the-data" class="section level3">
<h3>Tidying the data</h3>
<p>There are a couple more changes to be made before I can start visualizing climate change in Berlin. First, <a href="https://www.tidyverse.org/">tidyverse</a> magic works most potently on <em>long</em> data, but the DW uses <em>wide</em> format (<a href="https://en.wikipedia.org/wiki/Wide_and_narrow_data">see the difference here</a>). Second, the variable abbreviations are hard to understand (FM, RSK, etc.), so I should replace them with something else. Third and last, I now have four datasets, one for each Berlin weather station, but one would be preferable.</p>
<p>I’ll change the variable names using the following map.</p>
<pre class="r"><code>var_names &lt;- c(&quot;Date&quot; = &quot;MESS_DATUM&quot;,
               &quot;Avg. Wind Speed (m/sec)&quot; = &quot;FM&quot;,
               &quot;Max Wind Speed (m/sec)&quot; = &quot;FX&quot;,
               &quot;Avg. Cloud Cover (8th)&quot; = &quot;NM&quot;,
               &quot;Avg. Air Pressure (hPa)&quot; = &quot;PM&quot;,
               &quot;Precipitation (mm)&quot; = &quot;RSK&quot;,
               &quot;Sun Shine Duration (h)&quot; = &quot;SDK&quot;,
               &quot;Snow (cm)&quot; = &quot;SHK_TAG&quot;,
               &quot;Avg. Temp. (°C)&quot; = &quot;TMK&quot;,
               &quot;Min. Temp. (°C)&quot; = &quot;TNK&quot;,
               &quot;Max Temp. (°C)&quot; = &quot;TXK&quot;,
               &quot;Avg. Humidity (%)&quot; = &quot;UPM&quot;
               )</code></pre>
<p>The following <code>tidy_data</code> function reduces each data frame to the set of variables I’m interested in, converts the character strings to numbers and dates, and <code>gathers</code> the variables into long format.</p>
<pre class="r"><code>tidy_data &lt;- function(df, vars, station_name){
    df &lt;- select(df, vars)
    df &lt;- as_tibble(sapply(df, as.double))
    df$Date &lt;- ymd(df$Date)
    df &lt;- gather(df, key = &quot;Variable&quot;, value = &quot;Value&quot;, 2:12)
    df$Station &lt;- station_name
    df
}</code></pre>
<p>I can now call <code>tidy_data</code> for each station, and then combine the station data into one data frame <code>berlin_data</code>.</p>
<pre class="r"><code># call tidy_data for each station dataset
dahlem_lfag_data &lt;- tidy_data(dahlem_lfag_data, var_names, &quot;Dahlem (LFAG)&quot;)
dahlem_fu_data &lt;- tidy_data(dahlem_fu_data, var_names, &quot;Dahlem (FU)&quot;)
tegel_data &lt;- tidy_data(tegel_data, var_names, &quot;Tegel&quot;)
tempelhof_data &lt;- tidy_data(tempelhof_data, var_names, &quot;Tempelhof&quot;)

# combine station data into one data frame
berlin_data &lt;- rbind(dahlem_lfag_data, dahlem_fu_data, tegel_data, tempelhof_data)</code></pre>
<p>There’s just one final change I’d like to make: The values reflect daily averages, and measurement began in the 19th century for some stations, so I’m faced with hundreds of thousands of observations! To make things more manageable I’ll include different time scales, e.g. years, months, weeks, days, and <a href="https://en.wikipedia.org/wiki/Season#Meteorological">meteorological seasons</a>. While I’m at it I’ll also convert months and seasons to factors.</p>
<pre class="r"><code># add years, months, weeks, days, and seasons
berlin_data &lt;- berlin_data %&gt;% 
    mutate(Year = year(Date),
           Month = month(Date),
           Week = week(Date),
           Day = day(Date),
           Season = case_when(Month %in% c(12, 1, 2) ~ &quot;Winter&quot;,
                              Month %in% 3:5 ~ &quot;Spring&quot;,
                              Month %in% 6:8 ~ &quot;Summer&quot;,
                              Month %in% 9:11 ~ &quot;Fall&quot;,
                              )
           )

# turn seasons into factors
berlin_data$Season &lt;- factor(berlin_data$Season,
                             ordered = T,
                             levels = c(&quot;Spring&quot;, &quot;Summer&quot;, &quot;Winter&quot;, &quot;Fall&quot;)
                             )

# turn months into factors
berlin_data$Month &lt;- factor(berlin_data$Month,
                            ordered = T,
                            levels = 1:12,
                            labels = c(&quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;,
                                       &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, 
                                       &quot;September&quot;, &quot;October&quot;, &quot;November&quot;,
                                       &quot;December&quot;
                                       )
                            )</code></pre>
</div>
<div id="section" class="section level3">
<h3></h3>
<p>I now have a few hundred thousand observations for each of four Berlin weather stations, which I can now freely group based on my analytical needs.</p>
<pre class="r"><code>berlin_data %&gt;% 
    group_by(Station) %&gt;% 
    summarise(&quot;number of observations&quot; = n()) %&gt;% 
    knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Station</th>
<th align="right">number of observations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Dahlem (FU)</td>
<td align="right">273207</td>
</tr>
<tr class="even">
<td align="left">Dahlem (LFAG)</td>
<td align="right">347446</td>
</tr>
<tr class="odd">
<td align="left">Tegel</td>
<td align="right">220979</td>
</tr>
<tr class="even">
<td align="left">Tempelhof</td>
<td align="right">281248</td>
</tr>
</tbody>
</table>
<p>I’m specifically interested in the question of whether or not the summers in Berlin have become objectively worse, i.e. colder and wetter. To arrive at an answer I’ll take a look at temperature, precipitation, and the amount of daily sunshine specifically for the summer months.</p>
<p>That said, I would also like to make some general observations. For example, I’m also interested in the question of how Berlin’s climate has changed over time. It would also be interesting to get some idea of how the various variables interact.</p>
</div>

                <br>
                
                  <div class="tags">
                    <strong>Tags:</strong>
                  
                    <a href="/tags/climate">climate</a>
                  
                    <a href="/tags/berlin">Berlin</a>
                  
                  </div>
                  <br />
                
                <p class="back-to-posts"><a href="/blog">Back to posts</a></p>
            </div>
            <br>
            <div class="disqus">
                <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "gershomtripp-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            
        </div>
    </div>
</section>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-123-45', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  

  <script type="text/javascript">
    hljs.initHighlightingOnLoad();
  </script>





</body>
</html>

