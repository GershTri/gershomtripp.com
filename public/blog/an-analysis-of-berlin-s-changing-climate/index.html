<!DOCTYPE html>
<html lang="en-US">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="author" content="Gershom Tripp">
<meta name="description" content="Introduction This analysis is inspired in part by conversations I’ve had, or overheard, about Berlin’s “worsening” weather. Putting aside individual interpretations of what “worse” means (“It’s too cold and rainy!”, say some, “It’s too hot!”, say others), there’s definitely something to the general observation that Berlin’s climate is changing. I’ve personally witnessed it in the 11&#43; years that I’ve lived here.
Beyond the motivation of being an intolerable Rechthaber at future gripe sessions, I think it’s important to explore how global warming and climate change manifest themselves at the local level.">

<meta property="og:title" content="An Analysis of Berlin’s Changing Climate." />
<meta property="og:description" content="Introduction This analysis is inspired in part by conversations I’ve had, or overheard, about Berlin’s “worsening” weather. Putting aside individual interpretations of what “worse” means (“It’s too cold and rainy!”, say some, “It’s too hot!”, say others), there’s definitely something to the general observation that Berlin’s climate is changing. I’ve personally witnessed it in the 11&#43; years that I’ve lived here.
Beyond the motivation of being an intolerable Rechthaber at future gripe sessions, I think it’s important to explore how global warming and climate change manifest themselves at the local level." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/an-analysis-of-berlin-s-changing-climate/" /><meta property="article:published_time" content="2018-09-13T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2018-09-13T00:00:00&#43;00:00"/>

<title>


     An Analysis of Berlin’s Changing Climate. 

</title>
<link rel="canonical" href="/blog/an-analysis-of-berlin-s-changing-climate/">







<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/default.min.css">




<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500">



    
    <link rel="stylesheet" href="/css/reset.css?t=2018-09-16%2019%3a15%3a34.560251%20%2b0200%20CEST%20m%3d%2b0.122189045">
    <link rel="stylesheet" href="/css/pygments.css?t=2018-09-16%2019%3a15%3a34.560251%20%2b0200%20CEST%20m%3d%2b0.122189045">
    <link rel="stylesheet" href="/css/main.css?t=2018-09-16%2019%3a15%3a34.560251%20%2b0200%20CEST%20m%3d%2b0.122189045">
    
        <link rel="stylesheet" href="/css/override.css?t=2018-09-16%2019%3a15%3a34.560251%20%2b0200%20CEST%20m%3d%2b0.122189045">
    




<link rel="shortcut icon"

    href="/img/leaf.ico"

>








</head>


<body lang="en">

<section class="header">
    <div class="container">
        <div class="content">
            
                
                
                
                
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                
                <a href="/"><img class="avatar" src="/img/profile-4x.png" srcset="/img/profile-4x.png 1x"></a>
            
            <a href="/"><div class="name">Gershom Tripp</div></a>
            
              <h3 class="self-intro">Freelance Data Scientist, R &amp; Python</h3>
            
            <nav>
                <ul>
                    
                        <li class="nav-blog"><a href="/blog/"><span>Blog</span></a></li>
                    
                        <li class="nav-about"><a href="/about/"><span>About</span></a></li>
                    
                </ul>
            </nav>
        </div>
    </div>
</section>

<section class="icons">
    <div class="container">
        <div class="content">
        
            <a href="//github.com/GershTri" target="_blank" rel="noopener"><img class="icon" src="/img/github.svg" alt="github" /></a>
        

        

        
            <a href="//twitter.com/ppirtmohsreg" target="_blank" rel="noopener"><img class="icon" src="/img/twitter.svg" alt="twitter" /></a>
        

	

        

        

        
            <a href="//linkedin.com/in/gershomtripp" target="_blank" rel="noopener"><img class="icon" src="/img/linkedin.svg" alt="linkedin" /></a>
        

        

        

        

        

        
            <a href="mailto:gershtripp@gmail.com"><img class="icon" src="/img/email.svg" alt="email" /></a>
        

        

        
        </div>
    </div>
</section>


<section class="main post non-narrow zero-top-spacing">
    <div class="container">
        <div class="content">
            <div class="front-matter">
                <div class="title-container">
                    <div class="page-heading">

    An Analysis of Berlin’s Changing Climate.

</div>

                    <div class="initials"><a href="/">ad</a></div>
                </div>
                <div class="meta">
                    
                    <div class="date" title='Thu Sep 13 2018 00:00:00 UTC'>Sep 13, 2018</div>
                    
                    
		    <div class="reading-time"><div class="middot"></div>12 minutes read</div>
                    
                </div>
            </div>
            <div class="markdown">
                <div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>This analysis is inspired in part by conversations I’ve had, or overheard, about Berlin’s “worsening” weather. Putting aside individual interpretations of what “worse” means (“It’s too cold and rainy!”, say some, “It’s too hot!”, say others), there’s definitely something to the general observation that Berlin’s climate is changing. I’ve personally witnessed it in the 11+ years that I’ve lived here.</p>
<p>Beyond the motivation of being an intolerable <a href="https://www.dict.cc/?s=rechthaber">Rechthaber</a> at future gripe sessions, I think it’s important to explore how global warming and climate change manifest themselves at the local level. Climate change is happening <a href="https://climate.nasa.gov/effects/">now</a>, and there’s some evidence that it’s accelerating even <a href="https://www.theguardian.com/world/2018/aug/21/arctics-strongest-sea-ice-breaks-up-for-first-time-on-record">faster than predicted</a>.</p>
<p>For the record, I’m neither a climatoligist nor a meteorologist, and nothing about my analysis below is cutting edge or original. That being said, I should still be able reach some conclusions.</p>
<p>The next couple of sections cover how I wrangle the data into a more manageable form. If you’re not interested in that kind of thing, <a href="#analysis">skip to the analysis</a>.</p>
</div>
<div id="massaging-the-data" class="section level3">
<h3>Massaging the data</h3>
<p>First off, the libraries:</p>
<pre class="r"><code>library(readr)
library(dplyr)
library(tidyr)
library(stats)
library(psych)
library(lubridate)
library(ggplot2)
library(ggridges)
library(corrplot)</code></pre>
<p>The data is a subset of the <a href="https://www.dwd.de/DE/leistungen/klimadatendeutschland/klarchivtagmonat.html">Deutscher Wetterdienst</a>’s extensive repository of weather data. It’s possible to get hourly measurements, going back decades, but I decided daily averages were enough for this analysis. Downloading the data programmatically from the DWD archive interface would have been horribly complex, so I did it the old-fashioned way: I downloaded the data as four ZIPs (from four Berlin weather stations), extracted the TXT/CSV files, renamed them to something more descriptive, and wrote some code to remove some excess white space that was interfering with the data import.</p>
<p><em>Edit</em>: While putting the final touches on this post I discovered that the DWD offers FTP access to their databases via the <a href="ftp://ftp-cdc.dwd.de/pub/CDC/">Climate Data Center</a>.</p>
<p>The data files are semicolon-delimited. To keep things simple I’ll import everything as character strings. Numeric and date objects are converted later, as needed. The value <code>-999</code> is imported as <code>NA</code>.</p>
<pre class="r"><code># get the names of  the data files, import them as text, remove white space and
# overwrite originals with de-whitespaced files
data_path &lt;- file.path(&quot;datasets&quot;, &quot;berlin_climate_data&quot;)
file_names &lt;- dir(data_path)
file_names &lt;- file_names[grep(pattern = &quot;data&quot;, file_names)]

for (file_name in file_names){
    file_path &lt;- file.path(data_path, file_name)
    file &lt;- read_file(file_path)
    file &lt;- gsub(&quot; &quot;, &quot;&quot;, file)
    write_file(file, file_path)
}

# wrapper function to load data with defaults
read_data &lt;- function(path){
    read_delim(file = path,
               delim = &quot;;&quot;,
               col_types = paste0(rep(&quot;c&quot;, 19), collapse = &quot;&quot;),
               na = &quot;-999&quot;
               )
}

# read in the data
dahlem_fu_data &lt;- read_data(file.path(data_path, &quot;Dahlem-(FU)-data.txt&quot;))
dahlem_lfag_data &lt;- read_data(file.path(data_path, &quot;Dahlem-(LFAG)-data.txt&quot;))
tegel_data &lt;- read_data(file.path(data_path, &quot;Tegel-data.txt&quot;))
tempelhof_data &lt;- read_data(file.path(data_path, &quot;Tempelhof-data.txt&quot;))</code></pre>
<p>It makes sense to take a look at the included parameter files to get an idea what kind of data I’m working with. These are in German (umlauts!), so I’ll use <code>guess_encoding()</code> from the <code>readr</code> library to figure out which ISO I need.</p>
<pre class="r"><code>guess_encoding(&quot;datasets/berlin_climate_data/Dahlem-(FU)-params.txt&quot;) %&gt;% 
    knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">encoding</th>
<th align="right">confidence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ISO-8859-1</td>
<td align="right">0.64</td>
</tr>
<tr class="even">
<td align="left">ISO-8859-9</td>
<td align="right">0.27</td>
</tr>
<tr class="odd">
<td align="left">ISO-8859-2</td>
<td align="right">0.24</td>
</tr>
</tbody>
</table>
<p>ISO-8859-1 it is. I don’t care too much about the details of each station, so I’ll just import one file, <code>Tempelhof-params.txt</code>, to gain some insight into the parameters, i.e. abbreviations, units used, etc.</p>
<pre class="r"><code># load parameter file
data_path &lt;- file.path(&quot;datasets&quot;, &quot;berlin_climate_data&quot;, &quot;Tempelhof-params.txt&quot;)
tempelhof_params &lt;- read_delim(file = data_path,
                               delim = &quot;;&quot;,
                               col_types = paste0(rep(&quot;c&quot;, 13), collapse = &quot;&quot;),
                               locale = locale(encoding = &quot;ISO-8859-1&quot;)
                               )

# filter and show parameters
tempelhof_params %&gt;%
    select(2:7) %&gt;% 
    filter(!duplicated(Parameter) &amp; !is.na(Parameter)) %&gt;% 
    knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Von_Datum</th>
<th align="left">Bis_Datum</th>
<th align="left">Stationsname</th>
<th align="left">Parameter</th>
<th align="left">Parameterbeschreibung</th>
<th align="left">Einheit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">19740101</td>
<td align="left">19741231</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">FM</td>
<td align="left">Tagesmittel der Windgeschwindigkeit m/s Messnetz 3</td>
<td align="left">m/sec</td>
</tr>
<tr class="even">
<td align="left">19740101</td>
<td align="left">19741231</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">FX</td>
<td align="left">Maximum der Windspitze Messnetz 3</td>
<td align="left">m/sec</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">NM</td>
<td align="left">Tagesmittel des Bedeckungsgrades</td>
<td align="left">Achtel</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">PM</td>
<td align="left">Tagesmittel des Luftdrucks</td>
<td align="left">hpa</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">RSK</td>
<td align="left">tgl. Niederschlagshoehe</td>
<td align="left">mm</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">RSKF</td>
<td align="left">tgl. Niederschlagsform (=Niederschlagshoehe_ind)</td>
<td align="left">nummerischer Code</td>
</tr>
<tr class="odd">
<td align="left">19701117</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">SDK</td>
<td align="left">tgl. Sonnenscheindauer</td>
<td align="left">Stunde</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">SHK_TAG</td>
<td align="left">Schneehoehe Tageswert</td>
<td align="left">cm</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">TGK</td>
<td align="left">Minimum der Lufttemperatur am Erdboden in 5cm Hoehe</td>
<td align="left">°C</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">TMK</td>
<td align="left">Tagesmittel der Temperatur</td>
<td align="left">°C</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">TNK</td>
<td align="left">Tagesminimum der Lufttemperatur in 2m Hoehe</td>
<td align="left">°C</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">TXK</td>
<td align="left">Tagesmaximum der Lufttemperatur in 2m Höhe</td>
<td align="left">°C</td>
</tr>
<tr class="odd">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">UPM</td>
<td align="left">Tagesmittel der Relativen Feuchte</td>
<td align="left">%</td>
</tr>
<tr class="even">
<td align="left">19480101</td>
<td align="left">20010331</td>
<td align="left">Berlin-Tempelhof</td>
<td align="left">VPM</td>
<td align="left">Tagesmittel des Dampfdruckes</td>
<td align="left">hpa</td>
</tr>
</tbody>
</table>
</div>
<div id="tidying-the-data" class="section level3">
<h3>Tidying the data</h3>
<p>There are a couple more changes to be made before I can start visualizing climate change in Berlin. First, <a href="https://www.tidyverse.org/">tidyverse</a> magic works most potently on <em>long</em> data, but the DW uses <em>wide</em> format (<a href="https://en.wikipedia.org/wiki/Wide_and_narrow_data">see the difference here</a>). Second, the variable abbreviations are hard to understand (FM, RSK, etc.), so I should replace them with something else. Third and last, I now have four datasets, one for each Berlin weather station, but one would be preferable.</p>
<p>I’ll change the variable names using the following map.</p>
<pre class="r"><code>var_names &lt;- c(&quot;Date&quot; = &quot;MESS_DATUM&quot;,
               &quot;Avg. Wind Speed (m/sec)&quot; = &quot;FM&quot;,
               &quot;Max Wind Speed (m/sec)&quot; = &quot;FX&quot;,
               &quot;Avg. Cloud Cover (8th)&quot; = &quot;NM&quot;,
               &quot;Avg. Air Pressure (hPa)&quot; = &quot;PM&quot;,
               &quot;Precipitation (mm)&quot; = &quot;RSK&quot;,
               &quot;Sun Shine Duration (h)&quot; = &quot;SDK&quot;,
               &quot;Snow (cm)&quot; = &quot;SHK_TAG&quot;,
               &quot;Avg. Temp. (°C)&quot; = &quot;TMK&quot;,
               &quot;Min. Temp. (°C)&quot; = &quot;TNK&quot;,
               &quot;Max Temp. (°C)&quot; = &quot;TXK&quot;,
               &quot;Avg. Humidity (%)&quot; = &quot;UPM&quot;
               )</code></pre>
<p>The following <code>tidy_data</code> function reduces each data frame to the set of variables I’m interested in, converts the character strings to numbers and dates, and <code>gathers</code> the variables into long format.</p>
<pre class="r"><code>tidy_data &lt;- function(df, vars, station_name){
    df &lt;- select(df, vars)
    df &lt;- as_tibble(sapply(df, as.double))
    df$Date &lt;- ymd(df$Date)
    df &lt;- gather(df, key = &quot;Variable&quot;, value = &quot;Value&quot;, 2:12)
    df$Station &lt;- station_name
    df
}</code></pre>
<p>I can now call <code>tidy_data</code> for each station, and then combine the station data into one data frame <code>berlin_data</code>.</p>
<pre class="r"><code># call tidy_data for each station dataset
dahlem_lfag_data &lt;- tidy_data(dahlem_lfag_data, var_names, &quot;Dahlem (LFAG)&quot;)
dahlem_fu_data &lt;- tidy_data(dahlem_fu_data, var_names, &quot;Dahlem (FU)&quot;)
tegel_data &lt;- tidy_data(tegel_data, var_names, &quot;Tegel&quot;)
tempelhof_data &lt;- tidy_data(tempelhof_data, var_names, &quot;Tempelhof&quot;)

# combine station data into one data frame
berlin_data &lt;- rbind(dahlem_lfag_data, dahlem_fu_data, tegel_data, tempelhof_data)</code></pre>
<p>There’s just one final change I’d like to make: The values reflect daily averages, and measurement began in the 19th century for some stations, so I’m faced with hundreds of thousands of observations! To make things more manageable I’ll include different time scales, e.g. years, months, weeks, days, and <a href="https://en.wikipedia.org/wiki/Season#Meteorological">meteorological seasons</a>. While I’m at it I’ll also convert months and seasons to factors.</p>
<pre class="r"><code># add years, months, weeks, days, and seasons
berlin_data &lt;- berlin_data %&gt;% 
    mutate(Year = year(Date),
           Month = month(Date),
           Week = week(Date),
           Day = day(Date),
           Season = case_when(Month %in% c(12, 1, 2) ~ &quot;Winter&quot;,
                              Month %in% 3:5 ~ &quot;Spring&quot;,
                              Month %in% 6:8 ~ &quot;Summer&quot;,
                              Month %in% 9:11 ~ &quot;Fall&quot;,
                              )
           )

# turn seasons into factors
berlin_data$Season &lt;- factor(berlin_data$Season,
                             ordered = T,
                             levels = c(&quot;Spring&quot;, &quot;Summer&quot;, &quot;Winter&quot;, &quot;Fall&quot;)
                             )

# turn months into factors
berlin_data$Month &lt;- factor(berlin_data$Month,
                            ordered = T,
                            levels = 1:12,
                            labels = c(&quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;,
                                       &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, 
                                       &quot;September&quot;, &quot;October&quot;, &quot;November&quot;,
                                       &quot;December&quot;
                                       )
                            )</code></pre>
</div>
<div id="visualizing-berlins-changing-climate" class="section level3">
<h3><a name="analysis"></a>Visualizing Berlin’s changing climate</h3>
<p>I now have a few hundred thousand observations for each of four Berlin weather stations, which I can freely group based on my analytical needs. The following table shows the total observations (daily averages) for each of Berlin’s four weather stations.</p>
<pre class="r"><code>berlin_data %&gt;% 
    group_by(Station) %&gt;% 
    summarise(&quot;number of observations&quot; = n()) %&gt;% 
    knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Station</th>
<th align="right">number of observations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Dahlem (FU)</td>
<td align="right">273207</td>
</tr>
<tr class="even">
<td align="left">Dahlem (LFAG)</td>
<td align="right">347446</td>
</tr>
<tr class="odd">
<td align="left">Tegel</td>
<td align="right">220979</td>
</tr>
<tr class="even">
<td align="left">Tempelhof</td>
<td align="right">281248</td>
</tr>
</tbody>
</table>
<p>Let’s first take a look at how average yearly temperatures have changed since 1876. The following time series shows that average yearly temperatures in Berlin have increased by about 2°C since the middle of the 20th century, although there is a fair amount of yearly variation.</p>
<pre class="r"><code># create variable to hold theme (reusable)
thm &lt;- theme_minimal() + 
    theme(panel.grid.minor = element_blank(),
          panel.grid.major.x = element_blank()
          )

berlin_data %&gt;% 
    filter(Variable == &quot;Avg. Temp. (°C)&quot;) %&gt;%
    group_by(Station, Year) %&gt;% 
    summarise(Value = mean(Value, na.rm = T)) %&gt;%
    ggplot(aes(x = Year, y = Value)) +  
    geom_line(aes(color = Station)) +
    geom_smooth(se = F, method = &quot;lm&quot;, span = .2) +
    labs(title = &quot;Avg. Yearly Temperature (°C), 1876-2017&quot;,
         y = &quot;Temp.&quot;
         ) +
    thm +
    scale_x_continuous(limits = c(1876, 2017),
                       breaks = seq(1877, 2017, by = 10)
                       ) +
    scale_y_continuous(limits = c(3, 12),
                       breaks = seq(3, 12, by = 1)
                       )</code></pre>
<p><img src="/blog/2018-09-13-an-analysis-of-berlin-s-changing-climate_files/figure-html/viz%20mean%20yearly%20temps-1.png" width="672" /></p>
<p>Something else that immediately jumps out is the precipitous drop in 1945. Histograms of each year from 1940-1950 reveal bimodal distributions of daily temperatures for most years. One mode is missing from 1945, however - that is to say, some data is missing - and the data that is available clusters around the low end. A table giving the number of observations (i.e. number of daily averages) confirms this.</p>
<pre class="r"><code>berlin_data %&gt;% 
    filter(Station == &quot;Dahlem (LFAG)&quot;,
           Variable == &quot;Avg. Temp. (°C)&quot;,
           Year %in% 1941:1949,
           !is.na(Value)
           ) %&gt;% 
    ggplot(aes(x = Value)) + 
    geom_histogram(bins = 30) +
    facet_wrap(~Year) + 
    theme_minimal() + 
    theme(panel.grid.minor = element_blank(),
          panel.grid.major.x = element_blank(),
          panel.spacing = unit(2, &quot;lines&quot;)
          ) +
    labs(title = &quot;Distribution of Annual Temperatures (°C), 1941-1949&quot;,
         x = &quot;Temperature&quot;
         )</code></pre>
<p><img src="/blog/2018-09-13-an-analysis-of-berlin-s-changing-climate_files/figure-html/viz%20distribution%20of%20temps%201941-1949-1.png" width="672" /></p>
<pre class="r"><code>berlin_data %&gt;% 
    filter(Station == &quot;Dahlem (LFAG)&quot;,
           Variable == &quot;Avg. Temp. (°C)&quot;,
           Year %in% 1941:1949,
           !is.na(Value)
           ) %&gt;% 
    group_by(Year) %&gt;% 
    summarize(&quot;number of obs.&quot; = n(),
              &quot;annual avg. temp.&quot; = mean(Value))</code></pre>
<pre><code>## # A tibble: 9 x 3
##    Year `number of obs.` `annual avg. temp.`
##   &lt;dbl&gt;            &lt;int&gt;               &lt;dbl&gt;
## 1  1941              365            7.714247
## 2  1942              365            7.910685
## 3  1943              365            9.704110
## 4  1944              366            9.407104
## 5  1945              170            3.472353
## 6  1946              365            9.191233
## 7  1947              365            8.942740
## 8  1948              366            9.934153
## 9  1949              365            9.959726</code></pre>
<p>The <a href="https://en.wikipedia.org/wiki/Battle_of_Berlin">Battle of Berlin</a> was in the spring of 1945, so there’s really no question as to why the data is missing. I could go to the trouble of interpolating values from the flanking years, but I that wouldn’t affect the overall trends at all, so I’ll just drop 1945 instead. I’ll also aggregate the station data to make later visualizations a little easier.</p>
<pre class="r"><code>berlin_data &lt;- berlin_data &lt;- filter(berlin_data, Year != 1945) %&gt;% 
    group_by(Year, Month, Week, Day, Season, Date, Variable) %&gt;% 
    summarise(Value = mean(Value, na.rm = T)) %&gt;% 
    ungroup()</code></pre>
<p>The next chart compares changes in Berlin’s average yearly temperature with global temperature shifts. First, I need to download some data of global historical temperatures from <a href="https://climate.nasa.gov/vital-signs/global-temperature/">NASA</a>.</p>
<pre class="r"><code># get global temp. data from NASA
nasa_data &lt;- read_tsv(&quot;https://climate.nasa.gov/system/internal_resources/details/original/647_Global_Temperature_Data_File.txt&quot;,
                      col_names = c(&quot;Year&quot;, &quot;World&quot;, &quot;lowess&quot;),
                      col_types = &quot;idd&quot;
                      )</code></pre>
<p>I can then combine the NASA data with the Berlin data and visualize them together. The following graph shows the trend in mean global temperatures compared to Berlin. Note that the y-axis displays average annual temperature <em>change</em> in °C, and <em>not</em> average annual temperature. What I call change NASA calls <strong>annual average anomaly</strong>, which is the “change in global surface temperature relative to 1951-1980 average temperatures”. To maintain consistency with NASA’s data I’ll also transform the data to represent the change from the 1951-1980 average. Also note that I plot Loess curves with <code>span = 0.2</code> to cut down on some of the noise.</p>
<pre class="r"><code>berlin_data %&gt;%
    filter(Variable == &quot;Avg. Temp. (°C)&quot;,
           ) %&gt;%
    group_by(Year) %&gt;%
    summarise(Value = mean(Value, na.rm = T)) %&gt;%
    # put Berlin data in relation to 1951-1980 average
    mutate(Berlin = Value - mean(filter(.data = .,
                                        Year %in% 1951:1980
                                        )[[&quot;Value&quot;]]
                                 )
           ) %&gt;%  
    right_join(nasa_data, by = &quot;Year&quot;) %&gt;%
    select(Year, Berlin, World) %&gt;%
    filter(!is.na(Berlin), !is.na(World)) %&gt;% 
    # loess transform
    mutate(Berlin = predict(loess(Berlin ~ Year, data = ., span = 0.2)),
           World = predict(loess(World ~ Year, data = ., span = 0.2))
           ) %&gt;% 
    gather(key = &quot;Scope&quot;, value = &quot;Value&quot;, 2:3) %&gt;%
    ggplot(aes(x = Year, y= Value)) +
    geom_line(aes(color = Scope), size = 1) +
    geom_hline(yintercept = 0, linetype = 8) +
    thm + 
    scale_x_continuous(limits = c(1876, 2017),
                       breaks = seq(1877, 2017, by = 10)
                       ) +
    scale_y_continuous(limits = c(-1, 2),
                       breaks = seq(-1, 2, .5)) +
    labs(color = &quot;&quot;,
         title = &quot;Temp. Change in °C (LOESS), World vs. Berlin, 1877-2017&quot;,
         y = &quot;Change (°C)&quot;
         )</code></pre>
<p><img src="/blog/2018-09-13-an-analysis-of-berlin-s-changing-climate_files/figure-html/viz%20global%20and%20local%20temp%20change-1.png" width="672" /></p>
<p>The upward trend in mean annual temperatures in Berlin broadly matches that of the global aggregate. Interestingly, temperatures seem to be increasing faster in Berlin: average annual temperatures in Berlin have increased by about 2°C since 1925, compared to a 1°C globally.</p>
<pre class="r"><code>berlin_data %&gt;% 
    filter(Variable == &quot;Max Temp. (°C)&quot;,
           Month %in% c(&quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;),
           Year &gt; 1956
           ) %&gt;%
    group_by(Year, Month) %&gt;% 
    summarise(Value = sum(Value &gt; 25)/n()) %&gt;% 
    ggplot(aes(x = Year, y = Value, color = Month)) +
    geom_line(alpha = .3) +
    geom_smooth(method = &quot;lm&quot;, se = F) +
    scale_x_continuous(limits = c(1957, 2017),
                       breaks = seq(1957, 2017, by = 10)
                       ) +
    scale_y_continuous(limits = c(0, 1),
                       breaks = seq(0, 1, by = .1)) +
    theme_minimal() + 
    theme(panel.grid.minor = element_blank(),
          panel.grid.major.x = element_blank(),
          panel.spacing.x = unit(1.5, &quot;lines&quot;)
          ) +
    labs(title = &quot;Proportion of Days with Temp. &gt; 25°C, 1957-2017&quot;,
         y = &quot;Proportion&quot;
         )</code></pre>
<p><img src="/blog/2018-09-13-an-analysis-of-berlin-s-changing-climate_files/figure-html/temperatures%20greater%20that%2025C-1.png" width="672" /> The spike in July corresponds with the <a href="https://en.wikipedia.org/wiki/2006_European_heat_wave">2006 European heat wave</a>.</p>
</div>
<div id="todo" class="section level3">
<h3>!TODO</h3>
<pre><code>* </code></pre>
<pre class="r"><code>berlin_data %&gt;% 
    filter(Variable == &quot;Sun Shine Duration (h)&quot;,
           Year &gt; 1956,
           Month %in% c(&quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;),
           !is.na(Value)
           ) %&gt;%
    group_by(Year, Month) %&gt;% 
    summarize(Value = mean(Value)) %&gt;% 
    ggplot(aes(x = Year, y = Value, color = Month)) +
    geom_line(alpha = .3) +
    geom_smooth(method = &quot;lm&quot;, se = F) + 
    scale_x_continuous(limits = c(1957, 2017),
                       breaks = seq(1957, 2017, by = 10)
                       ) + 
    scale_y_continuous(limits = c(2.4, 12.5),
                       breaks = seq(2.5, 12.5, by = 1)) +
    theme_minimal() + 
    theme(panel.grid.minor = element_blank(),
          panel.grid.major.x = element_blank()
          ) +
    labs(title = &quot;Avg. Daily Sunshine (Hours), 1957-2017&quot;,
         y= &quot;Duration (h)&quot;
         )</code></pre>
<p><img src="/blog/2018-09-13-an-analysis-of-berlin-s-changing-climate_files/figure-html/avg.%20daily%20sunshine%20by%20month-1.png" width="672" /></p>
<pre class="r"><code>berlin_data %&gt;% 
    filter(Variable == &quot;Precipitation (mm)&quot;,
           Year &gt; 1956,
           Month %in% c(&quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;),
           !is.na(Value)
           ) %&gt;%
    group_by(Year, Month) %&gt;% 
    summarize(Value = mean(Value)) %&gt;% 
    ggplot(aes(x = Year, y = Value, color = Month)) +
    geom_line(alpha = .3) +
    geom_smooth(method = &quot;lm&quot;, se = F) + 
    scale_x_continuous(limits = c(1957, 2017),
                       breaks = seq(1957, 2017, by = 10)
                       ) + 
    scale_y_continuous(limits = c(-0.5, 7.5),
                       breaks = seq(0, 7.5, by = 1)) +
    theme_minimal() + 
    theme(panel.grid.minor = element_blank(),
          panel.grid.major.x = element_blank()
          ) +
    labs(title = &quot;Avg. Daily Precipitation (mm), 1957-2017&quot;,
         y= &quot;Amount (mm)&quot;
         )</code></pre>
<p><img src="/blog/2018-09-13-an-analysis-of-berlin-s-changing-climate_files/figure-html/avg.%20daily%20precipitation%20by%20month-1.png" width="672" /></p>
<pre class="r"><code>berlin_data %&gt;% 
    filter(Variable == &quot;Precipitation (mm)&quot;,
           Year &gt; 1956,
           Month %in% c(&quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;),
           !is.na(Value)
           ) %&gt;%
    group_by(Year, Month) %&gt;% 
    summarize(Value = sum(Value == 0)/n()) %&gt;% 
    ggplot(aes(x = Year, y = Value, color = Month)) +
    geom_line(alpha = .3) +
    geom_smooth(method = &quot;lm&quot;, se = F) + 
    scale_x_continuous(limits = c(1957, 2017),
                       breaks = seq(1957, 2017, by = 10)
                       ) + 
    scale_y_continuous(limits = c(0.1, .95),
                       breaks = seq(0.1, .9, by = .1)) +
    theme_minimal() + 
    theme(panel.grid.minor = element_blank(),
          panel.grid.major.x = element_blank()
          ) +
    labs(title = &quot;Days Without Precipitation (Proportion), 1957-2017&quot;,
         y= &quot;Proportion&quot;
         )</code></pre>
<p><img src="/blog/2018-09-13-an-analysis-of-berlin-s-changing-climate_files/figure-html/proportion%20days%20without%20precipitation%20by%20month-1.png" width="672" /></p>
</div>

                <br>
                
                  <div class="tags">
                    <strong>Tags:</strong>
                  
                    <a href="/tags/climate">climate</a>
                  
                    <a href="/tags/berlin">Berlin</a>
                  
                  </div>
                  <br />
                
                <p class="back-to-posts"><a href="/blog">Back to posts</a></p>
            </div>
            <br>
            <div class="disqus">
                <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "gershomtripp-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            
        </div>
    </div>
</section>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-123-45', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  

  <script type="text/javascript">
    hljs.initHighlightingOnLoad();
  </script>





</body>
</html>

