---
title: A Tale of One More City
author: Gershom Tripp
date: '2018-12-01'
tags:
  - Berlin
  - Germany
  - Yelp
  - R
  - Dataviz
slug: a-tale-of-one-more-city
---



<p>Intro here.</p>
<div id="some-demographics" class="section level2">
<h2>Some Demographics</h2>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_population_density-1.png" width="672" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_foreign_residents-1.png" width="672" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_average_age-1.png" width="672" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_political_parties-1.png" width="624" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_afd_representation-1.png" width="672" /></p>
</div>
<div id="characterizing-berlin-districts-through-yelp-reviews" class="section level2">
<h2>Characterizing Berlin Districts Through Yelp Reviews</h2>
<p>First, a glimpse of the data.</p>
<pre><code>## Observations: 17,976
## Variables: 12
## $ id                    &lt;chr&gt; &quot;d0NEZdBlNt1EAZ3oRT2Osg&quot;, &quot;yMz08uk3Q7UjF...
## $ name                  &lt;chr&gt; &quot;Endlich&quot;, &quot;Glienicker Br√ºcke&quot;, &quot;Lutter ...
## $ review_count          &lt;int&gt; 2, 21, 20, 4, 1, 1, 2, 39, 2, 8, 1, 4, 1...
## $ categories.title      &lt;chr&gt; &quot;Bistros&quot;, &quot;Landmarks &amp; Historical Build...
## $ rating                &lt;dbl&gt; 4.0, 4.5, 3.5, 5.0, 5.0, 5.0, 5.0, 3.0, ...
## $ coordinates.latitude  &lt;dbl&gt; 52.40460, 52.41351, 52.41455, 52.41423, ...
## $ coordinates.longitude &lt;dbl&gt; 13.06500, 13.09074, 13.09483, 13.09314, ...
## $ location.city         &lt;chr&gt; &quot;Berlin&quot;, &quot;Berlin&quot;, &quot;Berlin&quot;, &quot;Berlin&quot;, ...
## $ location.zip_code     &lt;int&gt; 10783, 14109, 14109, 14109, 14109, 14109...
## $ location.state        &lt;chr&gt; &quot;BE&quot;, &quot;BE&quot;, &quot;BE&quot;, &quot;BE&quot;, &quot;BE&quot;, &quot;BE&quot;, &quot;BE&quot;...
## $ price                 &lt;chr&gt; NA, NA, &quot;‚Ç¨‚Ç¨‚Ç¨&quot;, NA, NA, NA, NA, &quot;‚Ç¨‚Ç¨&quot;, NA,...
## $ district              &lt;chr&gt; &quot;Tempelhof-Sch√∂neberg&quot;, &quot;Steglitz-Zehlen...</code></pre>
<p>Although the total number of observations from the dataset is 17976, the total number of businesses is actually 11989. The remaining 5987 observations are duplicates.</p>
<p>A dot density plot can give us some perspective on the distribution of Yelp-reviewed businesses.</p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_dot_density_all_businesses-1.png" width="672" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_30_most_reviewed_berlin-1.png" width="672" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_30_businesses_with_most_reviews-1.png" width="672" /></p>
</div>
<div id="excursus-deciding-on-a-metric" class="section level2">
<h2>Excursus: Deciding on a Metric</h2>
<p>Ilia Blinderman and Amber Thomas <a href="https://pudding.cool/2018/03/neighborhoods/">draw</a> on Katie Hempenius‚Äô reasoning in her <a href="https://katiehempenius.com/post/yelp-map-of-san-francisco/">analysis</a> of San Francisco‚Äôs neighborhoods. With the dual goals of ‚Äúidentify[ing] interesting trends‚Äù and ‚Äúnormaliz[ing] for the effects of commercial versus residential usage‚Äù in mind, Katie arrives at the following formula for ‚Äúincidence rate‚Äù:</p>
<p><span class="math display">\[
X = \frac{Category\;Z\;in\;zip}{Category\;Z\;in\;city} \times
\frac{Businesses\;in\;city}{Businesses\;in\;zip}
\]</span></p>
<p>I have a number of problems with this metric, ranging from major to minor.</p>
<p>Fortunately, the biggest issue is also the easiest to address. Simply put, the above formula does <em>not</em> describe the incidence rate. The <a href="https://www.cdc.gov/ophss/csels/dsepd/ss1978/lesson3/section2.html">incidence rate</a> is a measure of <em>new cases</em> in a specified period of <em>time</em>. Time, however, doesn‚Äôt play a role in the Katie‚Äôs formula. Instead, the formula describes the proportion of all category members that can be found in a given district, multiplied by a constant.</p>
<p>Less of an issue, but perhaps relevant in terms of computational resources, is the fact that the second half of the equation - the constant - scales all the proporitions upwards without actually changing the relationships between them. That is to say, it has no effect on the neighborhood-level rankings, which is what we are interested in. A simplified formula will produce the same results:</p>
<p><span class="math display">\[
X = \frac{Category\;Z\;in\;zip}{Category\;Z\;in\;city}
\]</span></p>
<p>As a virtuous programmer (I try ü§∑) I‚Äôll attempt to zero in on a good solution via edge cases, which I can formulate in a series of what-ifs:</p>
<p>What if‚Ä¶</p>
<ol style="list-style-type: decimal">
<li>a neighborhood is home to a category whose members make up less than 1% of all categories, but draws a disproportionate amount of interest, as measured by the number of reviews? Zoos, botanical gardens, etc. come to mind.</li>
<li>a neighborhood is home to a large proportion of a category‚Äôs city-wide members, but they collectively make up a small fraction of all businesses in the district?</li>
<li>one category member is responsible for a large amount of interest, as measured by review count? For example, in the dot chart <em>Thirty Businesses with the Most Yelp Reviews</em> above, Mustafa‚Äôs Gem√ºse Kebap is the clear winner, but most kebap/kebab stands don‚Äôt get anywhere near that number of reviews.</li>
</ol>
<p>Dropping categories with small sample sizes (Ilia and Amber set a threshold of 1% of a district‚Äôs businesses) ignores the issue posed by <em>1.</em>, i.e.¬†that a neighborhood might be characterized by a small number of unusual businesses, or perhaps a single, very large institution.</p>
<p>I think most of the confusion here stems from the fact that specific epidemiological terminology is being used in a context where an epidemological approach is perfectly valid, but how the terminology is being used isn‚Äôt quite right.</p>
<p>Using the proportion <code>category in district/category in city</code> can be misleading.</p>
<p><br></p>
</div>
<div id="friedrichshain-kreuzberg" class="section level2">
<h2>Friedrichshain-Kreuzberg</h2>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/highlight_friedrichshain_kreuzberg-1.png" width="240" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_top_6_friedrichshain_kreuzberg-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="mitte" class="section level2">
<h2>Mitte</h2>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/highlight_mitte-1.png" width="240" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_top_6_mitte-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="charlottenburg-wilmersdorf" class="section level2">
<h2>Charlottenburg-Wilmersdorf</h2>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/highlight_charlottenburg_wilmersdorf-1.png" width="240" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_top_6_charlottenburg_wilmersdorf-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="steglitz-zehlendorf" class="section level2">
<h2>Steglitz-Zehlendorf</h2>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/highlight_steglitz_zehlendorf-1.png" width="240" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_top_6_steglitz_zehlendorf-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="tempelhof-schoneberg" class="section level2">
<h2>Tempelhof-Sch√∂neberg</h2>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/highlight_tempelhof_scho%CC%88neberg-1.png" width="240" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_top_6_tempelhof_scho%CC%88neberg-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="neukolln" class="section level2">
<h2>Neuk√∂lln</h2>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/highlight_neukoelln-1.png" width="240" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_top_6_neukoelln-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="treptow-kopenick" class="section level2">
<h2>Treptow-K√∂penick</h2>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/highlight_treptow_koepenick-1.png" width="240" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_top_6_treptow_koepenick-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="marzahn-hellersdorf" class="section level2">
<h2>Marzahn-Hellersdorf</h2>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/highlight_marzahn_hellersdorf-1.png" width="240" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_top_6_marzahn_hellersdorf-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="lichtenberg" class="section level2">
<h2>Lichtenberg</h2>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/highlight_lichtenberg-1.png" width="240" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_top_6_lichtenberg-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="pankow" class="section level2">
<h2>Pankow</h2>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/highlight_pankow-1.png" width="240" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_top_6_pankow-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="reinickendorf" class="section level2">
<h2>Reinickendorf</h2>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/highlight_reinikendorf-1.png" width="240" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_top_6_reinikendorf-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="spandau" class="section level2">
<h2>Spandau</h2>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/highlight_spandau-1.png" width="240" /></p>
<p><img src="/blog/2018-12-01-a-tale-of-one-more-city_files/figure-html/plot_top_6_spandau-1.png" width="672" /></p>
</div>
